### ========================================================================
### 变量配置区 (运行前请根据实际情况修改)
### ========================================================================

# 服务地址 (如果您通过 SSH 隧道映射了远程服务，或者在本地跑，通常是 localhost)
@host = localhost
# 服务端口 (根据您的 application.yml，端口是 8085)
@port = 8085

# 模拟参数
@shopId = 1
# 注意：这个 aftersaleId 最好在数据库 service_service 表对应的逻辑中是“有意义”的
# 虽然当前代码只用来透传，但建议用一个正整数
@aftersaleId = 8888

# 认证 Token
# 1. 如果您的网关/过滤器开启了校验，这里必须填写真实的 Bearer Token
# 2. 如果是本地开发且关闭了安全校验，可以填任意非空字符串
@token = Bearer eyJhbGciOiJIUzI1NiJ9.xxxxx.yyyyy

### ========================================================================
### 1. 测试创建服务单 (Internal API)
### API: POST /internal/shops/{shopId}/aftersales/{id}/serviceorders
### ========================================================================
POST http://{{host}}:{{port}}/internal/shops/{{shopId}}/aftersales/{{aftersaleId}}/serviceorders
Content-Type: application/json
Authorization: {{token}}

{
  "type": 0,
  "consignee": {
    "name": "测试员小张",
    "mobile": "13912345678",
    "regionId": 110101,
    "address": "福建省厦门市思明区厦门大学信息学院"
  }
}

> {%
    // 响应断言脚本 (可选)
    client.test("Request executed successfully", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });

    client.test("Return code is 201 (CREATED)", function() {
        var body = response.body;
        // 检查 errno 是否为 0 (ReturnNo.OK) 或者您定义的 CREATED 状态码
        // 假设 ReturnNo.CREATED 对应的 errno 是 0 或特定值，这里检查 data 是否存在
        client.assert(body.data !== null, "Return data should not be null");
    });
%}

### ========================================================================
### 2. (可选) 错误测试 - 缺少必填项 (测试 @Validated 校验)
### 预期结果: 400 Bad Request
### ========================================================================
POST http://{{host}}:{{port}}/internal/shops/{{shopId}}/aftersales/{{aftersaleId}}/serviceorders
Content-Type: application/json
Authorization: {{token}}

{
  "type": 0,
  "consignee": {
    "name": "",
    "mobile": "13912345678"
    // 缺少 regionId, address，且 name 为空
  }
}