### ========================================================================
### æœåŠ¡å•æŸ¥è¯¢æ¥å£æµ‹è¯•æ–‡ä»¶
### æ–‡ä»¶å: test-service-query.http
### ========================================================================

### ========================================================================
### ã€é…ç½®åŒºã€‘
### ========================================================================

# æœåŠ¡åœ°å€å’Œç«¯å£
@host = localhost
@port = 8085

# æµ‹è¯•ç”¨çš„å•†é“º ID
@shopId = 100

# æµ‹è¯•ç”¨çš„æœåŠ¡å• IDï¼ˆå¯¹åº” SQL è„šæœ¬æ•°æ®ï¼‰
@validServiceOrderId = 1001      # æ­£å¸¸æœåŠ¡å•
@finishedServiceOrderId = 1002   # å·²å®ŒæˆæœåŠ¡å•
@wrongShopServiceOrderId = 1003  # å…¶ä»–å•†é“ºæœåŠ¡å• (200å·å•†é“º)
@unacceptedServiceOrderId = 1004 # å¾…æ¥å—æœåŠ¡å•
@nonExistServiceOrderId = 99999  # ä¸å­˜åœ¨æœåŠ¡å•

# è®¤è¯ Token (å³ä½¿å…³é—­äº† @Auditï¼ŒHeader ä¹Ÿå¯ä»¥ç•™ç€)
@token = Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6InNlYW4iLCJpYXQiOjE1MTYyMzkwMjIsImV4cCI6MTkwMDAwMDAwMH0.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c

### ========================================================================
### ã€æµ‹è¯•ç”¨ä¾‹ 1ã€‘æŸ¥è¯¢æ­£å¸¸çš„æœåŠ¡å• - æˆåŠŸ
### ========================================================================
GET http://{{host}}:{{port}}/shops/{{shopId}}/services/{{validServiceOrderId}}
Authorization: {{token}}
Content-Type: application/json

> {%
    client.test("âœ… ç”¨ä¾‹1: æŸ¥è¯¢æˆåŠŸ", function() {
        client.assert(response.status === 200, "HTTP çŠ¶æ€ç åº”ä¸º 200");
        var body = response.body;
        client.assert(body.errno === 0, "ä¸šåŠ¡é”™è¯¯ç åº”ä¸º 0");

        var data = body.data;
        client.assert(data.id === 1001, "æœåŠ¡å• ID é”™è¯¯");
        client.assert(data.shopId === 100, "å•†é“º ID é”™è¯¯");
        client.assert(data.consignee === "å¼ ä¸‰", "æ”¶ä»¶äººé”™è¯¯");
        client.log("âœ… è¿”å›æ•°æ®é¢„è§ˆ: " + JSON.stringify(data));
    });
%}

### ========================================================================
### ã€æµ‹è¯•ç”¨ä¾‹ 2ã€‘æŸ¥è¯¢å·²å®Œæˆçš„æœåŠ¡å• - æˆåŠŸ (éªŒè¯è¿å•å·)
### ========================================================================
GET http://{{host}}:{{port}}/shops/{{shopId}}/services/{{finishedServiceOrderId}}
Authorization: {{token}}
Content-Type: application/json

> {%
    client.test("âœ… ç”¨ä¾‹2: æŸ¥è¯¢å·²å®ŒæˆæœåŠ¡å•", function() {
        client.assert(response.status === 200, "HTTP çŠ¶æ€ç åº”ä¸º 200");
        var body = response.body;
        var data = body.data;
        client.assert(data.status === 5, "çŠ¶æ€åº”ä¸ºå·²å®Œæˆ(5)");
        client.assert(data.expressId === 888, "è¿å• ID åº”ä¸º 888");
    });
%}

### ========================================================================
### ã€æµ‹è¯•ç”¨ä¾‹ 3ã€‘æŸ¥è¯¢ä¸å±äºè¯¥å•†é“ºçš„æœåŠ¡å• - æƒé™ä¸è¶³
### é¢„æœŸï¼šHTTP 403, errno = 17 (RESOURCE_ID_OUTSCOPE)
### ========================================================================
GET http://{{host}}:{{port}}/shops/{{shopId}}/services/{{wrongShopServiceOrderId}}
Authorization: {{token}}
Content-Type: application/json

> {%
    client.test("âŒ ç”¨ä¾‹3: è¶Šæƒè®¿é—®æ‹¦æˆª", function() {
        client.assert(response.status === 403, "é¢„æœŸè¿”å› 403 Forbidden");
        var body = response.body;
        // æ³¨æ„ï¼šOOMALL æ ‡å‡†ä¸­ RESOURCE_ID_OUTSCOPE çš„ errno æ˜¯ 17
        client.assert(body.errno === 17, "ä¸šåŠ¡é”™è¯¯ç åº”ä¸º 17, å®é™…æ˜¯: " + body.errno);
    });
%}

### ========================================================================
### ã€æµ‹è¯•ç”¨ä¾‹ 4ã€‘æŸ¥è¯¢ä¸å­˜åœ¨çš„æœåŠ¡å• - èµ„æºä¸å­˜åœ¨
### é¢„æœŸï¼šHTTP 404, errno = 4 (RESOURCE_ID_NOTEXIST)
### ========================================================================
GET http://{{host}}:{{port}}/shops/{{shopId}}/services/{{nonExistServiceOrderId}}
Authorization: {{token}}
Content-Type: application/json

> {%
    client.test("âŒ ç”¨ä¾‹4: èµ„æºä¸å­˜åœ¨æ‹¦æˆª", function() {
        client.assert(response.status === 404, "é¢„æœŸè¿”å› 404 Not Found");
        var body = response.body;
        client.assert(body.errno === 4, "ä¸šåŠ¡é”™è¯¯ç åº”ä¸º 4");
    });
%}

### ========================================================================
### ã€æµ‹è¯•ç”¨ä¾‹ 5ã€‘æŸ¥è¯¢å¾…æ¥å—çš„æœåŠ¡å• - æˆåŠŸ (éªŒè¯ result ä¸ºç©º)
### ========================================================================
GET http://{{host}}:{{port}}/shops/{{shopId}}/services/{{unacceptedServiceOrderId}}
Authorization: {{token}}
Content-Type: application/json

> {%
    client.test("âœ… ç”¨ä¾‹5: æŸ¥è¯¢å¾…æ¥å—å•æ®", function() {
        client.assert(response.status === 200, "HTTP çŠ¶æ€ç åº”ä¸º 200");
        var data = response.body.data;
        // å…¼å®¹å¤„ç†ï¼šnull æˆ–ç©ºå­—ç¬¦ä¸²éƒ½è§†ä¸ºé€šè¿‡
        client.assert(data.result === null || data.result === "", "æœªå¤„ç†å•æ® result åº”ä¸ºç©º");
    });
%}

### ========================================================================
### ã€æµ‹è¯•ç”¨ä¾‹ 6ã€‘è®¤è¯æ ¡éªŒæµ‹è¯• (éœ€è¦å¼€å¯ @Audit)
### âš ï¸ å¦‚æœä½ æ³¨é‡Šäº† Controller çš„ @Auditï¼Œæ­¤é¡¹ä¼šè¿”å› 200 å¯¼è‡´æ–­è¨€å¤±è´¥
### ========================================================================
GET http://{{host}}:{{port}}/shops/{{shopId}}/services/{{validServiceOrderId}}
Content-Type: application/json

> {%
    client.test("ğŸ”’ ç”¨ä¾‹6: ç¼ºå°‘ Token æ‹¦æˆª", function() {
        if (response.status === 200) {
            client.log("âš ï¸ æç¤º: æ¥å£å½“å‰æœªå¼€å¯æƒé™æ ¡éªŒ(AOPå·²å…³é—­)");
        } else {
            client.assert(response.status === 401, "å¼€å¯æ ¡éªŒæ—¶åº”è¿”å› 401");
        }
    });
%}

### ========================================================================
### ã€æµ‹è¯•ç”¨ä¾‹ 7ã€‘é”™è¯¯çš„ HTTP æ–¹æ³• - 405
### ========================================================================
POST http://{{host}}:{{port}}/shops/{{shopId}}/services/{{validServiceOrderId}}
Authorization: {{token}}

> {%
    client.test("âœ… ç”¨ä¾‹7: 405 æ–¹æ³•é”™è¯¯æ‹¦æˆª", function() {
        client.assert(response.status === 405, "åº”è¿”å› 405 Method Not Allowed");
    });
%}

### ========================================================================
### ã€æµ‹è¯•ç”¨ä¾‹ 8ã€‘éæ³•çš„ ID ç±»å‹ - 400
### ========================================================================
GET http://{{host}}:{{port}}/shops/{{shopId}}/services/abc
Authorization: {{token}}

> {%
    client.test("âœ… ç”¨ä¾‹8: 400 å‚æ•°æ ¼å¼é”™è¯¯æ‹¦æˆª", function() {
        client.assert(response.status === 400, "åº”è¿”å› 400 Bad Request");
    });
%}